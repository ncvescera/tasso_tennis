{% extends "layout.html" %}
{% block content %}
<h1>Dashboard</h1>

<p><b>I tuoi campi: </b></p>
<div id="campi"></div>

<a href="{{url_for('addfield')}}"><button type="button" class="btn btn-outline-info">Aggiungi un campo</button></a>
<br>
<br>
<hr>

<p><b>Le prenotazioni sui tuoi campi: </b></p>
<div id="prenotazioni"></div>


<script>
    // chiamata per ricezioni dati
    function elimina(id) {
        $.ajax({
            url: '/api/fields/'+id,
            type: 'DELETE',

            success: function(response) {
                risposta = JSON.parse(response);    // converte la risposta in JSON
                alert(risposta.message);
                location.reload();
                //ricarica la pagina
            },

            error: function(error) {
                errore = JSON.parse(error.responseText)     // converte la risposta in JSON
                alert(errore.error);
            }
        });
    } 
   
    $.ajax({
        url: '/api/fields',
        type: 'GET',

        success: function(response) {
            risposta = JSON.parse(response);    // converte la risposta in JSON
            dati = risposta.rep;
            
            var tabella = $("<table></table>").addClass('table table-hover table-striped');
            var tbody = $("<tbody></tbody>");

            dati.forEach(element => {
                var riga = $("<tr></tr>");

                var col1 = $("<td></td>").text(element.name);
                var col2 = $("<td></td>").text(element.description);
                var col3 = $("<td></td>").text('â‚¬ '+ element.price_h);
                var col4 = $("<td></td>").append($("<button></button>").addClass('btn btn-danger').attr('onclick', 'elimina('+element.id+')').text('Elimina'));
                
                riga.append(col1, col2, col3, col4);
                tbody.append(riga);
            });
            tabella.append(tbody);
            $("#campi").html(tabella);
        },

        error: function(error) {
            errore = JSON.parse(error.responseText)     // converte la risposta in JSON
        }
    });
</script>
{% endblock content %}